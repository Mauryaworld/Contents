<!DOCTYPE html>
<html>
<head>
  <title>GitHub File Uploader</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/filepond/4.19.0/filepond.min.js"></script>
</head>
<body>
  <h1>GitHub File Uploader</h1>
  <div id="filepond"></div>
  <script>
    $(function() {
      // Initialize FilePond
      var pond = FilePond.create(document.getElementById('filepond'), {
        filepondDefaults: {
          allowMultiple: true,
          maxFileSize: 1000000,
          acceptedFileTypes: ['*']
        }
      });

      // Handle file uploads
      pond.on('filepondfileadd', function(event) {
        var file = event.file;
        // Get the GitHub authentication code
        var code = prompt('Enter your GitHub authentication code');

        // Upload the file to the selected repository
        $.ajax({
          url: 'https://api.github.com/repos/<username>/<repo>/contents',
          type: 'POST',
          headers: {
            Authorization: 'Bearer ' + code
          },
          data: {
            path: file.name,
            content: file.data
          }
        }).done(function() {
          alert('File uploaded successfully!');
        }).fail(function(error) {
          alert(error);
        });
      });

      // Handle login
      var loginDialog = document.getElementById('login-dialog');
      loginDialog.addEventListener('show.bs.modal', function() {
        // Clear the username and password fields
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
      });

      var loginButton = document.getElementById('login-button');
      loginButton.addEventListener('click', function() {
        // Get the selected login method
        var loginMethod = document.getElementById('login-method').value;

        // Log in to GitHub
        if (loginMethod === 'github') {
          var code = prompt('Enter your GitHub authentication code');
          loginWithGitHub(code);
        } else {
          loginWithUsernameAndPassword();
        }
      });
    });
  </script>
  <script>
    function login() {
  // Check if the user is already logged in
  if (localStorage.getItem('token')) {
    return;
  }

  // Show the login dialog
  var dialog = document.getElementById('login-dialog');
  dialog.showModal();

  // Handle the login button click event
  var loginButton = document.getElementById('login-button');
  loginButton.addEventListener('click', function() {
    // Get the selected login method
    var loginMethod = document.getElementById('login-method').value;

    // Log in to GitHub
    if (loginMethod === 'github') {
      var code = prompt('Enter your GitHub authentication code');
      loginWithGitHub(code);
    } else if (loginMethod === 'google') {
      loginWithGoogle();
    } else {
      loginWithUsernameAndPassword();
    }
  });
}

// Login with GitHub
function loginWithGitHub(code) {
  // Get the GitHub API token
  var token = github.getAccessToken(code);

  // Store the token in localStorage
  localStorage.setItem('token', token);

  // Close the login dialog
  var dialog = document.getElementById('login-dialog');
  dialog.close();

  // Redirect the user to the home page
  window.location.href = '/';
}

// Login with Google
function loginWithGoogle() {
  // Redirect the user to the Google OAuth 2.0 authorization endpoint
  window.location.href = 'https://accounts.google.com/o/oauth2/auth?client_id=YOUR_CLIENT_ID&redirect_uri=YOUR_REDIRECT_URI&scope=https://www.googleapis.com/auth/userinfo.email&response_type=code';
}

// Login with username and password
function loginWithUsernameAndPassword() {
  // Get the username and password from the user
  var username = document.getElementById('username').value;
  var password = document.getElementById('password').value;

  // Check if the username and password are valid
  if (!username || !password) {
    alert('Please enter your username and password');
    return;
  }

  // Login to the server
  $.ajax({
    url: '/login',
    type: 'POST',
    data: {
      username: username,
      password: password
    },
    success: function(data) {
      // Store the token in localStorage
      localStorage.setItem('token', data.token);

      // Close the login dialog
      var dialog = document.getElementById('login-dialog');
      dialog.close();

      // Redirect the user to the home page
      window.location.href = '/';
    },
    error: function(error) {
      alert(error);
    }
  });
}
  </script>
</body>
</html>
